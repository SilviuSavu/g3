<svg width="800" height="260" xmlns="http://www.w3.org/2000/svg" font-family="Arial, sans-serif">
  <rect width="100%" height="100%" fill="white"/>

  <!-- States -->
  <g id="states">
    <!-- Startup -->
    <rect x="60" y="60" width="80" height="40" rx="8" ry="8" fill="#e3f2fd" stroke="#1565c0" stroke-width="2"/>
    <text x="100" y="85" font-size="12" text-anchor="middle" fill="#333">Startup</text>

    <!-- PromptForRequirements -->
    <rect x="220" y="60" width="140" height="40" rx="8" ry="8" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
    <text x="290" y="85" font-size="12" text-anchor="middle" fill="#333">PromptForRequirements</text>

    <!-- RefineRequirements -->
    <rect x="420" y="60" width="150" height="40" rx="8" ry="8" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
    <text x="495" y="85" font-size="12" text-anchor="middle" fill="#333">RefineRequirements</text>

    <!-- ImplementRequirements -->
    <rect x="650" y="60" width="150" height="40" rx="8" ry="8" fill="#c8e6c9" stroke="#388e3c" stroke-width="2"/>
    <text x="725" y="85" font-size="12" text-anchor="middle" fill="#333">ImplementRequirements</text>

    <!-- ImplementationComplete -->
    <rect x="650" y="140" width="150" height="40" rx="8" ry="8" fill="#ffccbc" stroke="#e64a19" stroke-width="2"/>
    <text x="725" y="165" font-size="12" text-anchor="middle" fill="#333">ImplementationComplete</text>

    <!-- Quit -->
    <rect x="70" y="200" width="60" height="40" rx="8" ry="8" fill="#ffccbc" stroke="#e64a19" stroke-width="2"/>
    <text x="100" y="225" font-size="12" text-anchor="middle" fill="#333">Quit</text>
  </g>

  <!-- Transitions -->
  <g id="transitions" stroke="black" stroke-width="1.5" fill="none" marker-end="url(#arrow)">
    <!-- Startup to PromptForRequirements -->
    <path d="M140 80 L220 80"/>

    <!-- PromptForRequirements to RefineRequirements -->
    <path d="M360 80 L420 80"/>

    <!-- RefineRequirements to PromptForRequirements (loop back) -->
    <path d="M500 110 C500 130 390 130 390 110"/>
    <text x="445" y="140" font-size="10" text-anchor="middle" fill="#666">User rejects (Refine)</text>

    <!-- RefineRequirements to ImplementRequirements -->
    <path d="M570 80 L650 80"/>
    <text x="610" y="70" font-size="10" text-anchor="middle" fill="#666">User approves (Approve)</text>

    <!-- RefineRequirements to Quit -->
    <path d="M495 100 L495 180 L140 210"/>

    <!-- ImplementRequirements to ImplementationComplete -->
    <path d="M725 100 L725 140"/>

    <!-- ImplementationComplete to PromptForRequirements -->
    <path d="M725 140 L495 140"/>
    <text x="610" y="130" font-size="10" text-anchor="middle" fill="#666">User commits (Complete)</text>

    <!-- ImplementationComplete to ImplementRequirements -->
    <path d="M650 160 L570 160"/>
    <text x="610" y="170" font-size="10" text-anchor="middle" fill="#666">User continues (Continue)</text>

    <!-- ImplementationComplete to Quit -->
    <path d="M725 160 L725 200 L140 210"/>

    <!-- Quit to end -->
    <path d="M80 220 L80 240 L50 240 L50 250"/>
  </g>

  <!-- Initial state marker -->
  <circle cx="20" cy="80" r="6" fill="#1565c0"/>
  <path d="M26 80 L60 80" stroke="black" stroke-width="1.5"/>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="black"/>
    </marker>
  </defs>

  <!-- Recovery substate -->
  <g id="recovery" transform="translate(250, 160)">
    <rect x="0" y="0" width="160" height="70" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1" stroke-dasharray="5,5"/>
    <text x="80" y="20" font-size="11" text-anchor="middle" fill="#7b1fa2" font-weight="bold">Recovery</text>

    <rect x="20" y="30" width="80" height="30" rx="6" ry="6" fill="#e1bee7" stroke="#8e24aa" stroke-width="1"/>
    <text x="60" y="50" font-size="10" text-anchor="middle" fill="#333">Recovery</text>

    <!-- Recovery transitions -->
    <path d="M60 30 L60 0" stroke="black" stroke-width="1"/>
    <path d="M60 60 L60 90 L120 90 L120 100" stroke="black" stroke-width="1"/>

    <text x="60" y="25" font-size="9" text-anchor="middle" fill="#666" style="pointer-events:none">Resume</text>
    <text x="120" y="105" font-size="9" text-anchor="middle" fill="#666" style="pointer-events:none">MarkComplete</text>
    <text x="30" y="105" font-size="9" text-anchor="middle" fill="#666" style="pointer-events:none">Quit</text>
  </g>
</svg>
